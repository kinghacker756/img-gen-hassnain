<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HASSNAIN-IMG-GEN | AI Image Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7b2cbf;
            --secondary: #9d4edd;
            --dark: #10002b;
            --light: #f8f9fa;
            --gray: #e9ecef;
            --dark-gray: #495057;
            --accent: #ff9e00;
            --success: #28a745;
            --error: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        body {
            background-color: #f5f3ff;
            color: var(--dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-image: radial-gradient(circle at 10% 20%, rgba(123, 44, 191, 0.05) 0%, rgba(123, 44, 191, 0.05) 90%);
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(123, 44, 191, 0.3);
            position: relative;
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 1.8rem;
            color: var(--accent);
        }

        .logo h1 {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        nav a:hover {
            color: var(--accent);
            transform: translateY(-2px);
        }

        nav a i {
            font-size: 1.1rem;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid var(--gray);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            transform: translateX(0);
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
            width: 0;
            padding: 0;
            border: none;
        }

        .sidebar-header {
            padding: 0.5rem 0;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            font-size: 1.1rem;
            color: var(--primary);
            font-weight: 600;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            color: var(--dark-gray);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .toggle-sidebar:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        .new-chat-btn {
            width: 100%;
            padding: 0.85rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(123, 44, 191, 0.3);
        }

        .new-chat-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(123, 44, 191, 0.4);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
        }

        .history-item {
            padding: 0.85rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s;
            background-color: white;
            border: 1px solid var(--gray);
        }

        .history-item:hover {
            background-color: rgba(123, 44, 191, 0.1);
            border-color: rgba(123, 44, 191, 0.3);
        }

        .history-item.active {
            background-color: rgba(123, 44, 191, 0.15);
            border-color: var(--primary);
            color: var(--primary);
        }

        .history-item-icon {
            color: var(--primary);
            font-size: 1.1rem;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            position: relative;
        }

        .chat-header {
            padding: 1.2rem;
            border-bottom: 1px solid var(--gray);
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: white;
            z-index: 5;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.4rem;
            cursor: pointer;
        }

        .chat-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.8rem;
            background-color: #fafaff;
        }

        .message {
            display: flex;
            gap: 1.2rem;
            max-width: 90%;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user .message-avatar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .assistant .message-avatar {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }

        .message-content {
            padding: 1rem 1.2rem;
            border-radius: 12px;
            background-color: var(--gray);
            max-width: 100%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            line-height: 1.6;
        }

        .user .message-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-bottom-right-radius: 0;
        }

        .assistant .message-content {
            border-bottom-left-radius: 0;
            background-color: white;
            border: 1px solid var(--gray);
        }

        .message-content p {
            margin-bottom: 0.5rem;
        }

        .message-content ul {
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .message-content a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .message-content a:hover {
            text-decoration: underline;
        }

        .generated-image {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-top: 1rem;
            border: 1px solid var(--gray);
            transition: all 0.3s;
        }

        .generated-image:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        .image-options {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .image-option-btn {
            padding: 0.5rem 0.8rem;
            background-color: white;
            border: 1px solid var(--gray);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .image-option-btn:hover {
            background-color: var(--gray);
        }

        .image-option-btn.download {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .image-option-btn.download:hover {
            background-color: #6a1b9a;
        }

        .input-container {
            padding: 1.5rem;
            border-top: 1px solid var(--gray);
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .prompt-form {
            display: flex;
            gap: 12px;
            position: relative;
        }

        .prompt-input {
            flex: 1;
            padding: 1rem 1.2rem;
            border: 1px solid var(--gray);
            border-radius: 12px;
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 150px;
            transition: all 0.3s;
            background-color: #fafaff;
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .prompt-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(123, 44, 191, 0.2);
        }

        .send-btn {
            padding: 0 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(123, 44, 191, 0.3);
        }

        .send-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(123, 44, 191, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .settings-panel {
            padding: 1.2rem;
            border-top: 1px solid var(--gray);
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .settings-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 0.5rem 0;
            transition: all 0.3s;
        }

        .settings-toggle:hover {
            color: var(--primary);
        }

        .settings-content {
            display: none;
            padding: 1rem 0 0.5rem;
            animation: fadeIn 0.3s ease-out;
        }

        .settings-content.show {
            display: block;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-group h4 {
            margin-bottom: 0.8rem;
            font-weight: 500;
            color: var(--primary);
        }

        .style-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .style-option {
            padding: 0.6rem 0.9rem;
            border: 1px solid var(--gray);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .style-option:hover {
            background-color: rgba(123, 44, 191, 0.1);
            border-color: var(--primary);
        }

        .style-option.selected {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(123, 44, 191, 0.3);
        }

        .loading {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-message {
            padding: 0.8rem;
            text-align: center;
            color: var(--dark-gray);
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .error-message {
            color: var(--error);
            background-color: #f8d7da;
            padding: 0.8rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .error-message.show {
            display: block;
        }

        .footer {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
            font-size: 0.9rem;
            box-shadow: 0 -4px 20px rgba(123, 44, 191, 0.3);
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .footer a {
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .footer a:hover {
            color: var(--accent);
            transform: translateY(-2px);
        }
        
        .powered-by {
            margin-top: 0.8rem;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1rem;
        }

        .social-link {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .social-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        /* Mobile Responsiveness */
        @media (max-width: 992px) {
            .sidebar {
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 20;
                background-color: white;
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }

            .mobile-menu-btn {
                display: block;
            }

            .chat-header h2 {
                font-size: 1.1rem;
            }

            .message {
                max-width: 95%;
            }
        }

        @media (max-width: 576px) {
            header {
                padding: 1rem;
            }

            .logo h1 {
                font-size: 1.3rem;
            }

            nav ul {
                gap: 15px;
            }

            .prompt-form {
                flex-direction: column;
            }

            .send-btn {
                padding: 0.8rem;
                width: 100%;
            }

            .footer-links {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6a1b9a;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px rgba(123, 44, 191, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
            display: none;
        }

        .fab:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 6px 25px rgba(123, 44, 191, 0.5);
        }

        @media (max-width: 992px) {
            .fab {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <span class="logo-icon"><i class="fas fa-magic"></i></span>
            <h1>HASSNAIN-IMG-GEN</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#"><i class="fas fa-code"></i> API</a></li>
                <li><a href="https://whatsapp.com/channel/0029Vb5Wj7A1iUxVukeiWx21" target="_blank"><i class="fab fa-whatsapp"></i> Updates</a></li>
                <li><a href="https://wa.me/message/HGOA2RII2C4GD1" target="_blank"><i class="fas fa-headset"></i> Support</a></li>
            </ul>
        </nav>
    </header>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-history"></i> Generation History</h3>
                <button class="toggle-sidebar" id="toggleSidebar">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i> New Image
            </button>
            <div class="history-list" id="historyList">
                <!-- History items will be added here dynamically -->
                <div class="history-item empty-history">
                    <i class="fas fa-image history-item-icon"></i>
                    <span>No generation history yet</span>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <h2><i class="fas fa-robot"></i> HASSNAIN Image AI</h2>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message assistant">
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <h3>Welcome to <strong>HASSNAIN-IMG-GEN</strong>! ðŸŽ¨</h3>
                        <p>I'm your AI-powered image generation assistant. Describe what you'd like me to create, and I'll generate stunning images for you.</p>
                        
                        <p><strong>Try these prompts:</strong></p>
                        <ul>
                            <li>"A cute golden retriever playing in a sunny park"</li>
                            <li>"Cyberpunk cityscape at night with neon lights and rain"</li>
                            <li>"Majestic mountain landscape at sunset, digital art style"</li>
                            <li>"Portrait of a warrior queen with intricate armor"</li>
                        </ul>
                        
                        <p><strong>Pro Tip:</strong> Select different styles from the settings panel for unique results.</p>
                        
                        <p>For updates, join our <a href="https://whatsapp.com/channel/0029Vb5Wj7A1iUxVukeiWx21" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp Channel</a>.</p>
                        <p>Need help? <a href="https://wa.me/message/HGOA2RII2C4GD1" target="_blank"><i class="fas fa-headset"></i> Contact Support</a></p>
                        <p>Developed by <a href="https://github.com/kinghacker756" target="_blank"><i class="fab fa-github"></i> @kinghacker756</a></p>
                    </div>
                </div>
            </div>

            <div class="settings-panel">
                <div class="settings-toggle" id="settingsToggle">
                    <h3><i class="fas fa-sliders-h"></i> Advanced Settings</h3>
                    <span><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="settings-content" id="settingsContent">
                    <div class="setting-group">
                        <h4><i class="fas fa-paint-brush"></i> Image Style</h4>
                        <div class="style-options" id="styleOptions">
                            <!-- Styles will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <div class="error-message" id="errorMessage"></div>
                <form class="prompt-form" id="promptForm">
                    <textarea class="prompt-input" id="promptInput" placeholder="Describe the image you want to generate (e.g., 'A majestic lion in the savannah at sunset, ultra HD')" required></textarea>
                    <button type="submit" class="send-btn" id="sendBtn">
                        <span id="sendBtnText">Generate <i class="fas fa-magic"></i></span>
                        <span class="loading" id="loadingIndicator" style="display: none;"></span>
                    </button>
                </form>
                <div class="status-message">
                    <i class="fas fa-info-circle"></i> HASSNAIN-IMG-GEN may produce inaccurate images. Verify important details.
                </div>
            </div>
        </div>
    </div>

    <div class="fab" id="fab">
        <i class="fas fa-magic"></i>
    </div>

    <div class="footer">
        <div>Â© 2023 <strong>HASSNAIN-IMG-GEN</strong> - Advanced AI Image Generator</div>
        <div class="footer-links">
            <a href="https://whatsapp.com/channel/0029Vb5Wj7A1iUxVukeiWx21" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp Updates</a>
            <a href="https://wa.me/message/HGOA2RII2C4GD1" target="_blank"><i class="fas fa-headset"></i> Contact Support</a>
            <a href="https://github.com/kinghacker756" target="_blank"><i class="fab fa-github"></i> @kinghacker756</a>
            <a href="#"><i class="fas fa-book"></i> Documentation</a>
        </div>
        <div class="social-links">
            <a href="https://whatsapp.com/channel/0029Vb5Wj7A1iUxVukeiWx21" target="_blank" class="social-link">
                <i class="fab fa-whatsapp"></i>
            </a>
            <a href="https://github.com/kinghacker756" target="_blank" class="social-link">
                <i class="fab fa-github"></i>
            </a>
            <a href="https://wa.me/message/HGOA2RII2C4GD1" target="_blank" class="social-link">
                <i class="fas fa-headset"></i>
            </a>
        </div>
        <div class="powered-by">
            Powered by Text2Img API | Developed with <i class="fas fa-heart" style="color: #ff6b6b;"></i> by @kinghacker756
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const promptForm = document.getElementById('promptForm');
            const promptInput = document.getElementById('promptInput');
            const sendBtn = document.getElementById('sendBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const sendBtnText = document.getElementById('sendBtnText');
            const chatMessages = document.getElementById('chatMessages');
            const errorMessage = document.getElementById('errorMessage');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsContent = document.getElementById('settingsContent');
            const styleOptionsContainer = document.getElementById('styleOptions');
            const newChatBtn = document.getElementById('newChatBtn');
            const historyList = document.getElementById('historyList');
            const toggleSidebar = document.getElementById('toggleSidebar');
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const fab = document.getElementById('fab');

            // Available styles from the API
            const availableStyles = [
                "pointillism", "typography", "line_art", "caricature", "adorable_kawaii", 
                "psychedelic", "watercolor", "colored_pencil_art", "futuristic_retro_cyberpunk", 
                "stained_glass", "comic", "sumi_e_symbolic", "monochrome", "van_gogh", 
                "manga", "surreal_painting", "papercraft_kirigami", "papercraft_paper_quilling", 
                "pixel_art", "cubist", "papercraft_paper_mache", "lowpoly", "sticker", 
                "dripping_paint_splatter", "ink_dripping", "cross_stitching", "graffiti", 
                "alcohol_ink", "tlingit_art", "pop_art", "fauvism"
            ];

            // State
            let currentStyle = "futuristic_retro_cyberpunk";
            let isGenerating = false;
            let chatHistory = JSON.parse(localStorage.getItem('hassnainImgGenHistory')) || [];
            let currentSessionId = Date.now();

            // Initialize
            populateStyleOptions();
            renderHistory();
            checkEmptyHistory();
            
            // Event Listeners
            settingsToggle.addEventListener('click', function() {
                settingsContent.classList.toggle('show');
                this.querySelector('span').innerHTML = settingsContent.classList.contains('show') ? 
                    '<i class="fas fa-chevron-up"></i>' : '<i class="fas fa-chevron-down"></i>';
            });

            newChatBtn.addEventListener('click', function() {
                promptInput.value = '';
                errorMessage.classList.remove('show');
                currentSessionId = Date.now();
            });

            toggleSidebar.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                this.innerHTML = sidebar.classList.contains('collapsed') ? 
                    '<i class="fas fa-chevron-right"></i>' : '<i class="fas fa-chevron-left"></i>';
            });

            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
            });

            fab.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
            });

            promptInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            promptForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (isGenerating) return;
                
                const prompt = promptInput.value.trim();
                if (!prompt) {
                    showError('Please enter a description for the image you want to generate.');
                    return;
                }
                
                generateImage(prompt);
            });

            // Functions
            function populateStyleOptions() {
                styleOptionsContainer.innerHTML = '';
                
                availableStyles.forEach(style => {
                    const formattedStyle = style.replace(/_/g, ' ');
                    const styleOption = document.createElement('div');
                    styleOption.className = `style-option ${style === currentStyle ? 'selected' : ''}`;
                    styleOption.dataset.style = style;
                    styleOption.innerHTML = `<i class="fas fa-palette"></i> ${formattedStyle}`;
                    
                    styleOption.addEventListener('click', function() {
                        document.querySelector('.style-option.selected')?.classList.remove('selected');
                        this.classList.add('selected');
                        currentStyle = this.dataset.style;
                    });
                    
                    styleOptionsContainer.appendChild(styleOption);
                });
            }

            function generateImage(prompt) {
                isGenerating = true;
                sendBtn.disabled = true;
                loadingIndicator.style.display = 'inline-block';
                sendBtnText.style.display = 'none';
                errorMessage.classList.remove('show');
                
                // Add user message to chat
                addMessage(prompt, 'user');
                
                // Create API URL
                const apiUrl = `https://text2img.hideme.eu.org/image?prompt=${encodeURIComponent(prompt)}&model=flux&style=${currentStyle}`;
                
                // Call the API
                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.blob();
                    })
                    .then(blob => {
                        const imageUrl = URL.createObjectURL(blob);
                        handleApiResponse({
                            success: true,
                            imageUrl: imageUrl,
                            prompt: prompt,
                            style: currentStyle
                        }, prompt);
                    })
                    .catch(error => {
                        handleError(error);
                    });
            }
            
            function handleApiResponse(data, prompt) {
                isGenerating = false;
                sendBtn.disabled = false;
                loadingIndicator.style.display = 'none';
                sendBtnText.style.display = 'inline';
                
                if (data.success) {
                    // Format the style name for display
                    const formattedStyle = data.style.replace(/_/g, ' ');
                    
                    // Add AI response to chat
                    const message = `Here's your generated image in <strong>${formattedStyle}</strong> style: "${prompt}"`;
                    addMessage(message, 'assistant', data.imageUrl);
                    
                    // Add to history
                    addToHistory(prompt, data.imageUrl, data.style);
                } else {
                    showError('Failed to generate image. Please try again or check your internet connection.');
                }
            }
            
            function handleError(error) {
                isGenerating = false;
                sendBtn.disabled = false;
                loadingIndicator.style.display = 'none';
                sendBtnText.style.display = 'inline';
                
                console.error('Error:', error);
                showError('An error occurred. Please check your connection and try again.');
            }
            
            function showError(message) {
                errorMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                errorMessage.classList.add('show');
            }
            
            function addMessage(content, sender, imageUrl = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'message-avatar';
                avatarDiv.textContent = sender === 'user' ? 'You' : 'AI';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const textPara = document.createElement('div');
                textPara.innerHTML = content;
                contentDiv.appendChild(textPara);
                
                if (imageUrl && sender === 'assistant') {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = content;
                    img.className = 'generated-image';
                    img.loading = 'lazy';
                    contentDiv.appendChild(img);
                    
                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'image-options';
                    optionsDiv.innerHTML = `
                        <button class="image-option-btn download"><i class="fas fa-download"></i> Download</button>
                        <button class="image-option-btn"><i class="fas fa-sync-alt"></i> Regenerate</button>
                        <button class="image-option-btn"><i class="fas fa-edit"></i> Edit</button>
                    `;
                    contentDiv.appendChild(optionsDiv);
                    
                    // Add event listeners to buttons
                    optionsDiv.querySelectorAll('.image-option-btn')[0].addEventListener('click', () => {
                        downloadImage(imageUrl, `hassnain-img-${Date.now()}.jpg`);
                    });
                    
                    optionsDiv.querySelectorAll('.image-option-btn')[1].addEventListener('click', () => {
                        generateImage(content.match(/"(.+?)"/)[1]);
                    });
                    
                    optionsDiv.querySelectorAll('.image-option-btn')[2].addEventListener('click', () => {
                        promptInput.value = content.match(/"(.+?)"/)[1];
                        promptInput.focus();
                    });
                }
                
                messageDiv.appendChild(avatarDiv);
                messageDiv.appendChild(contentDiv);
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function downloadImage(url, filename) {
                showError('Preparing download... <i class="fas fa-spinner fa-spin"></i>');
                
                fetch(url)
                    .then(response => response.blob())
                    .then(blob => {
                        const blobUrl = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = blobUrl;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(blobUrl);
                        document.body.removeChild(a);
                        showError('<i class="fas fa-check-circle"></i> Download started!');
                        setTimeout(() => errorMessage.classList.remove('show'), 3000);
                    })
                    .catch(error => {
                        console.error('Download error:', error);
                        showError('<i class="fas fa-times-circle"></i> Failed to download image.');
                    });
            }
            
            function addToHistory(prompt, imageUrl, style) {
                // Create history item
                const historyItem = {
                    id: currentSessionId,
                    prompt,
                    imageUrl,
                    style,
                    timestamp: Date.now()
                };
                
                // Check if we're continuing the same session
                const currentSessionIndex = chatHistory.findIndex(item => item.id === currentSessionId);
                
                if (currentSessionIndex >= 0) {
                    // Update the existing session
                    chatHistory[currentSessionIndex] = historyItem;
                } else {
                    // Add new session
                    chatHistory.unshift(historyItem);
                    
                    // Limit history to 50 items
                    if (chatHistory.length > 50) {
                        chatHistory.pop();
                    }
                }
                
                // Save to localStorage
                localStorage.setItem('hassnainImgGenHistory', JSON.stringify(chatHistory));
                
                // Update UI
                renderHistory();
                checkEmptyHistory();
            }
            
            function renderHistory() {
                historyList.innerHTML = '';
                
                if (chatHistory.length === 0) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.className = 'history-item empty-history';
                    emptyMsg.innerHTML = `
                        <i class="fas fa-image history-item-icon"></i>
                        <span>No generation history yet</span>
                    `;
                    historyList.appendChild(emptyMsg);
                    return;
                }
                
                // Group by session
                const sessions = {};
                chatHistory.forEach(item => {
                    if (!sessions[item.id]) {
                        sessions[item.id] = item;
                    }
                });
                
                Object.values(sessions).forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = `history-item ${item.id === currentSessionId ? 'active' : ''}`;
                    historyItem.innerHTML = `
                        <i class="fas fa-image history-item-icon"></i>
                        <span>${item.prompt.length > 30 ? item.prompt.substring(0, 30) + '...' : item.prompt}</span>
                    `;
                    
                    historyItem.addEventListener('click', () => {
                        // Set current session
                        currentSessionId = item.id;
                        
                        // Clear current chat
                        chatMessages.innerHTML = `
                            <div class="message assistant">
                                <div class="message-avatar">AI</div>
                                <div class="message-content">
                                    <p>Here's your previously generated image:</p>
                                </div>
                            </div>
                        `;
                        
                        // Format the style name for display
                        const formattedStyle = item.style.replace(/_/g, ' ');
                        
                        // Add the history item
                        addMessage(
                            `Here's your previously generated image in <strong>${formattedStyle}</strong> style: "${item.prompt}"`,
                            'assistant',
                            item.imageUrl
                        );
                        
                        // Highlight in history
                        document.querySelectorAll('.history-item').forEach(el => el.classList.remove('active'));
                        historyItem.classList.add('active');
                    });
                    
                    historyList.appendChild(historyItem);
                });
            }
            
            function checkEmptyHistory() {
                const emptyHistory = document.querySelector('.empty-history');
                if (emptyHistory) {
                    emptyHistory.style.display = chatHistory.length === 0 ? 'flex' : 'none';
                }
            }

            // Initialize prompt input height
            promptInput.style.height = 'auto';
            promptInput.style.height = (promptInput.scrollHeight) + 'px';
        });
    </script>
</body>
</html>
